<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æ£®æ£®å¤©æ°£</title>
<link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;700;900&display=swap" rel="stylesheet">
<style>
:root {
    --ac-green: #7DE1A9;
    --ac-brown: #796452;
    --ac-dark: #58504A;
}
* { margin:0; padding:0; box-sizing:border-box; }
body {
    font-family: 'Zen Maru Gothic', sans-serif;
    min-height:100vh;
    background-size:cover;
    background-position:center;
    color: var(--ac-dark);
}
.bg-sunny { background-image: url('https://images.unsplash.com/photo-1502082553048-f009c37129b9?auto=format&w=1900&q=80'); }
.bg-rainy { background-image: url('https://images.unsplash.com/photo-1468476396571-4d6f2a427ee7?auto=format&w=1900&q=80'); }
.bg-cloudy { background-image: url('https://images.unsplash.com/photo-1521295121783-8a321d551ad2?auto=format&w=1900&q=80'); }

#today-block {
    position: fixed;
    left:50%; top:40%;
    transform: translate(-50%, -50%);
    width:clamp(300px, 80vw, 750px);
    background: rgba(255,255,255,0.55);
    backdrop-filter: blur(12px) saturate(120%);
    border-radius:20px;
    padding:clamp(12px,2vw,24px);
    box-shadow:0 20px 40px rgba(0,0,0,0.15);
    border:1px solid rgba(255,255,255,0.6);
    z-index:100;
    display: flex;
    flex-direction: column;
    gap:clamp(6px,1vw,12px);
}
#today-date {
    font-weight:900;
    font-size:clamp(1rem,2vw,1.4rem);
    text-align:center;
    margin-bottom:clamp(4px,1vw,8px);
}
#today-info-container {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap:clamp(8px,2vw,12px);
}
#weather-info {
    display:flex;
    flex-direction: row;
    align-items: center;
    gap:clamp(6px,1.5vw,10px);
    font-weight:700;
    flex:1;
    justify-content:flex-start;
}
#today-weather {
    font-size:clamp(2.5rem,6vw,3.5rem);
    animation: bounce 3s infinite;
}
#weather-description {
    display:flex;
    flex-direction: column;
    gap:clamp(2px,0.5vw,4px);
    font-weight:700;
    font-size:clamp(0.85rem,2vw,0.95rem);
}
#separator {
    width:2px;
    background: rgba(0,0,0,0.2);
    border-radius:1px;
    margin:0 4px;
}
#advice-info {
    display:flex;
    flex-direction: row;
    gap:clamp(8px,2vw,12px);
    align-items:center;
    font-weight:700;
    flex:1;
    justify-content:flex-end;
    font-size:clamp(0.8rem,1.8vw,0.95rem);
}
.advice-item {
    display:flex;
    flex-direction: column;
    align-items:center;
    font-weight:700;
    text-align:center;
}
.advice-item div:first-child {
    font-size:clamp(1.2rem,3vw,1.5rem);
    margin-bottom:2px;
}
#future-cards {
    position: fixed;
    top:calc(40% + clamp(180px,40vw,250px));
    left:50%; transform:translateX(-50%);
    display:flex;
    gap:10px;
    justify-content:center;
    width:clamp(300px,80vw,750px);
}
.small-card-wrapper {
    flex:1;
    background: rgba(255,255,255,0.55);
    backdrop-filter: blur(12px) saturate(120%);
    border-radius:16px;
    padding:clamp(8px,1vw,10px);
    box-shadow:0 10px 30px rgba(0,0,0,0.1);
    border:1px solid rgba(255,255,255,0.6);
}
.small-card {
    text-align:center;
    color: #333333; /* æ·±ç°è‰² */
    font-weight:700;
    background:none;
    border:none;
}
.small-card div { 
    margin:2px 0; 
    font-weight:700; 
    font-size:clamp(0.8rem,2vw,0.9rem); 
}

#location-tag {
    position: fixed;
    top: 12px;
    left: 12px;
    background: rgba(255,255,255,0.55);
    backdrop-filter: blur(10px) saturate(120%);
    padding:6px 12px;
    border-radius:16px;
    font-weight:900;
    font-size:clamp(0.8rem,2vw,1rem);
    display:flex;
    align-items:center;
    gap:6px;
    z-index:200;
}
#location-select { background:none; border:none; font-weight:900; font-size:clamp(0.8rem,2vw,1rem); }
@keyframes bounce {
    0%,100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
}
</style>
</head>
<body>

<div id="location-tag">
    ğŸ“ <select id="location-select">
        <option value="taipei">å°åŒ—å¸‚</option>
        <option value="newtaipei" selected>æ–°åŒ—å¸‚</option>
        <option value="taoyuan">æ¡ƒåœ’å¸‚</option>
        <option value="taichung">å°ä¸­å¸‚</option>
        <option value="tainan">å°å—å¸‚</option>
        <option value="kaohsiung">é«˜é›„å¸‚</option>
        <option value="keelung">åŸºéš†å¸‚</option>
        <option value="hsinchu_city">æ–°ç«¹å¸‚</option>
        <option value="hsinchu_county">æ–°ç«¹ç¸£</option>
        <option value="miaoli">è‹—æ —ç¸£</option>
        <option value="changhua">å½°åŒ–ç¸£</option>
        <option value="nantou">å—æŠ•ç¸£</option>
        <option value="yunlin">é›²æ—ç¸£</option>
        <option value="chiayi_city">å˜‰ç¾©å¸‚</option>
        <option value="chiayi_county">å˜‰ç¾©ç¸£</option>
        <option value="pingtung">å±æ±ç¸£</option>
        <option value="yilan">å®œè˜­ç¸£</option>
        <option value="hualien">èŠ±è“®ç¸£</option>
        <option value="taitung">å°æ±ç¸£</option>
        <option value="penghu">æ¾æ¹–ç¸£</option>
        <option value="kinmen">é‡‘é–€ç¸£</option>
        <option value="lienchiang">é€£æ±Ÿç¸£</option>
    </select>
</div>

<div id="today-block">
  <div id="today-date">è¼‰å…¥ä¸­...</div>
  <div id="today-info-container">
    <div id="weather-info">
      <div id="today-weather">â˜€ï¸</div>
      <div id="weather-description">
        <div id="today-temp">è¼‰å…¥ä¸­...</div>
        <div id="today-rain">è¼‰å…¥ä¸­...</div>
        <div id="today-comfort">è¼‰å…¥ä¸­...</div>
      </div>
    </div>
    <div id="separator"></div>
    <div id="advice-info">
      <div class="advice-item"><div id="advice-cloth-icon">ğŸ‘•</div><div id="advice-cloth-text">è¼‰å…¥ä¸­</div></div>
      <div class="advice-item"><div id="advice-rain-icon">ğŸŒ‚</div><div id="advice-rain-text">è¼‰å…¥ä¸­</div></div>
    </div>
  </div>
</div>

<div id="future-cards">
  <div class="small-card-wrapper"><div class="small-card"><div class="card-date">--</div><div class="card-weather">--</div><div class="card-temp">--</div></div></div>
  <div class="small-card-wrapper"><div class="small-card"><div class="card-date">--</div><div class="card-weather">--</div><div class="card-temp">--</div></div></div>
</div>

<script>
function formatDateChinese(dateStr){
    if(!dateStr) return "--";
    // dateStr å½¢å¦‚ "2025-12-07 06:00:00"
    const d = new Date(dateStr.replace(' ','T'));
    if(isNaN(d)) return "--";
    const dayNames = ["æ—¥","ä¸€","äºŒ","ä¸‰","å››","äº”","å…­"];
    const yyyy = d.getFullYear();
    const mm = String(d.getMonth()+1).padStart(2,'0');
    const dd = String(d.getDate()).padStart(2,'0');
    const w = dayNames[d.getDay()];
    return `${yyyy}.${mm}.${dd} (æ˜ŸæœŸ${w})`;
}

function getAdvice(rain, maxTemp){
    let rainIcon = 'ğŸŒ‚', rainText='ä¸ç”¨å¸¶å‚˜';
    if(parseInt(rain) > 30){ rainIcon='â˜‚ï¸'; rainText='è¨˜å¾—å¸¶å‚˜ï¼'; }
    let clothIcon='ğŸ‘•', clothText='èˆ’é©ç©¿æ­';
    if(parseInt(maxTemp)>=28){ clothIcon='ğŸ½'; clothText='çŸ­è¢–å‡ºé–€'; }
    else if(parseInt(maxTemp)<=20){ clothIcon='ğŸ§¥'; clothText='åŠ ä»¶å¤–å¥—'; }
    return {rainIcon, rainText, clothIcon, clothText};
}

async function fetchWeather(location){
  try {
    const res = await fetch(`http://localhost:3000/api/weather/${location}`);
    const json = await res.json();
    if (!json.success) return;
    const data = json.data;
    const forecasts = data.forecasts;

    // ä»Šæ—¥å¤©æ°£
    const today = forecasts[0];
    document.getElementById('today-date').textContent = formatDateChinese(today.startTime);
    document.getElementById('today-weather').textContent = today.weather.includes('æ™´') ? 'â˜€ï¸' : today.weather.includes('é›¨') ? 'ğŸŒ§ï¸' : 'â˜ï¸';
    document.getElementById('today-temp').textContent = `${today.minTemp} ~ ${today.maxTemp}`;
    document.getElementById('today-rain').textContent = `é™é›¨æ©Ÿç‡: ${today.rain}`;
    document.getElementById('today-comfort').textContent = today.comfort;

    // èƒŒæ™¯
    const body = document.body;
    body.classList.remove('bg-sunny','bg-rainy','bg-cloudy');
    if(today.weather.includes('æ™´')) body.classList.add('bg-sunny');
    else if(today.weather.includes('é›¨')) body.classList.add('bg-rainy');
    else body.classList.add('bg-cloudy');

    // å»ºè­°
    const advice = getAdvice(today.rain.replace('%',''), today.maxTemp.replace('Â°C',''));
    document.getElementById('advice-cloth-icon').textContent = advice.clothIcon;
    document.getElementById('advice-cloth-text').textContent = advice.clothText;
    document.getElementById('advice-rain-icon').textContent = advice.rainIcon;
    document.getElementById('advice-rain-text').textContent = advice.rainText;

    // æ˜å¾Œå…©å¤©
    const smallCards = document.querySelectorAll('.small-card');
    function fillCard(card, forecast){
        card.querySelector('.card-date').textContent = formatDateChinese(forecast.startTime);
        card.querySelector('.card-weather').textContent = forecast.weather.includes('æ™´') ? 'â˜€ï¸' :
                                                          forecast.weather.includes('é›¨') ? 'ğŸŒ§ï¸' : 'â˜ï¸';
        card.querySelector('.card-temp').textContent = `${forecast.minTemp} ~ ${forecast.maxTemp}`;
    }
    fillCard(smallCards[0], forecasts[1]);
    fillCard(smallCards[1], forecasts[2]);

  } catch(err) {
    console.error('å‰ç«¯è®€å–å¤©æ°£å¤±æ•—', err);
  }
}

const locationSelect = document.getElementById('location-select');
locationSelect.addEventListener('change', ()=>{ fetchWeather(locationSelect.value); });
fetchWeather(locationSelect.value);
</script>

</body>
</html>
